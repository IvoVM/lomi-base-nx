"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[719],{3719:(A,d,a)=>{a.r(d),a.d(d,{AuthComponent:()=>Z});var m=a(6814);var c=a(9862),v=a(6306),_=a(8504),e=a(5879);let u=(()=>{class o{constructor(){}setItem(t,n){localStorage.setItem(t,n)}getItem(t){const n=localStorage.getItem(t);return n?JSON.parse(n):null}removeItem(t){localStorage.removeItem(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const f="expirationDate";let M=(()=>{class o{constructor(t,n){this.http=t,this.localStorageService=n}saveToken(t){let n=JSON.stringify(t);this.localStorageService.setItem("token",n),this.saveTokenExpirationDate(t.expires_in)}saveTokenExpirationDate(t){let n=new Date((new Date).getTime()+1e3*t),s=JSON.stringify(n);this.localStorageService.setItem(f,s)}tokenIsExpired(){let t=this.localStorageService.getItem(f);if(t){let n=JSON.parse(t);return new Date((new Date).getTime()).toJSON()>=n}return console.log("there is no expire Date available")}refreshToken(t){return this.http.post("https://lomi.cl/spree_oauth/token",{grant_type:"refresh_token",refresh_token:t},{headers:new c.WM({Accept:"application/json","Content-Type":"application/json"})}).pipe((0,v.K)(n=>(0,_._)(n)))}saveNewToken(t){this.refreshToken(t.refresh_token).subscribe({next:n=>{console.log("savedTokenAfterRefreshed - next :"+n),this.saveToken(n)},error:n=>{console.log("savedTokenAfterRefreshed - error :"+n)}})}checkTokenExpirationAndRefresh(t){this.tokenIsExpired()&&(console.log("Token is expired"),this.saveNewToken(t))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(c.eN),e.LFG(u))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var h=a(3403);let P=(()=>{class o{constructor(t,n,s,p){this.http=t,this.router=n,this.tokenSvc=s,this.localStorageService=p}login(t,n){return this.http.post("https://lomi.cl/spree_oauth/token",{username:t,password:n,grant_type:"password",scope:"admin"},{headers:new c.WM({Accept:"application/json","Content-Type":"application/json"})})}verifyAdmin(t){return this.tokenSvc.saveToken(t),this.http.get("https://lomi.cl/api/v2/storefront/account",{headers:new c.WM({Accept:"application/vnd.api+json",Authorization:`Bearer ${t}`})})}logOut(){this.localStorageService.removeItem("token"),this.router.navigateByUrl("/login")}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(c.eN),e.LFG(h.F0),e.LFG(M),e.LFG(u))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var C=a(2032),g=a(9157),w=a(9323),i=a(6223),x=a(1631),T=a(2214);function S(o,r){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Esta direcci\xf3n de email no existe "),e.qZA())}function F(o,r){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," El email es "),e.TgZ(2,"strong"),e._uU(3," requerido"),e.qZA()())}function b(o,r){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," M\xednimo 3 caracteres "),e.qZA())}function y(o,r){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Por favor, ingrese una "),e.TgZ(2,"strong"),e._uU(3,"contrase\xf1a"),e.qZA()())}function k(o,r){if(1&o&&(e.TgZ(0,"mat-error",7),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",t.errorMessage," ")}}let I=(()=>{class o{constructor(t,n,s,p){this.fb=t,this.authService=n,this.LogedGuard=s,this.router=p,this.error=!1,this.allowedUsersTypes=["admin"],this.emailFormControl=new i.NI("",[i.kI.required,i.kI.email]),this.passwordFormControl=new i.NI("",[i.kI.required,i.kI.minLength(3)]),this.form=this.fb.group({username:this.emailFormControl,password:this.passwordFormControl})}login(){this.form.valid&&this.authService.login(this.form.value.username,this.form.value.password).pipe((0,x.z)(t=>this.authService.verifyAdmin(t.access_token))).subscribe({next:t=>{this.allowedUsersTypes.find(n=>t.data.attributes.roles)?(this.LogedGuard.userRoles=t.data.attributes,this.router.navigateByUrl(""),this.form.reset()):(this.error=!0,this.errorMessage=`Usuario de tipo ${t.data.type}, no esta autorizado a entrar a la aplicaci\xf3n`)},error:t=>{console.log(t),this.error=!0,this.errorMessage="Nombre de usuario y/o contrase\xf1a incorrectos"}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(i.qu),e.Y36(P),e.Y36(T.z),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["login-form"]],standalone:!0,features:[e.jDz],decls:12,vars:9,consts:[[1,"login-form",3,"formGroup","ngSubmit"],[1,"example-full-width"],["type","email","matInput","","placeholder","Correo electr\xf3nico",3,"formControl"],[4,"ngIf"],["type","password","matInput","","placeholder","Contrase\xf1a",3,"formControl"],["type","submit",3,"color"],["class","not-authorized",4,"ngIf"],[1,"not-authorized"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return n.login()}),e.TgZ(1,"mat-form-field",1),e._UZ(2,"input",2),e.YNc(3,S,2,0,"mat-error",3),e.YNc(4,F,4,0,"mat-error",3),e.qZA(),e.TgZ(5,"mat-form-field",1),e._UZ(6,"input",4),e.YNc(7,b,2,0,"mat-error",3),e.YNc(8,y,4,0,"mat-error",3),e.qZA(),e.TgZ(9,"lm-raised-button",5),e._uU(10,"Ingresar"),e.qZA(),e.YNc(11,k,2,1,"mat-error",6),e.qZA()),2&t&&(e.Q6J("formGroup",n.form),e.xp6(2),e.Q6J("formControl",n.emailFormControl),e.xp6(1),e.Q6J("ngIf",n.emailFormControl.hasError("email")&&!n.emailFormControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.emailFormControl.hasError("required")),e.xp6(2),e.Q6J("formControl",n.passwordFormControl),e.xp6(1),e.Q6J("ngIf",n.passwordFormControl.hasError("minlength")&&!n.passwordFormControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.passwordFormControl.hasError("required")),e.xp6(1),e.Q6J("color","accent"),e.xp6(2),e.Q6J("ngIf",n.error))},dependencies:[m.ez,m.O5,w.r,i.UX,i._Y,i.Fj,i.JJ,i.JL,i.oH,i.sg,g.lN,g.KE,g.TO,C.c,C.Nt],styles:[".login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:350px;padding:.6rem .5rem;border-radius:8px;border:none;border:2px solid #d1d2d2;color:#d7d7d7}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:#e8e9e9}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{padding:0;background:none;overflow:visible}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{display:block}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix{padding:0;width:100%;text-align:center}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper .mat-mdc-form-field-focus-overlay{background:none}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper .mdc-line-ripple{display:none}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-error-wrapper{top:-10px;left:-20px}.login-form[_ngcontent-%COMP%]   lm-raised-button[_ngcontent-%COMP%]     button{color:#fff;width:100%;border-radius:20px}.login-form[_ngcontent-%COMP%]   .not-authorized[_ngcontent-%COMP%]{margin-top:20px;width:370px}@media screen and (max-width: 768px){.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:300px}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-error-wrapper{left:0}.login-form[_ngcontent-%COMP%]   lm-raised-button[_ngcontent-%COMP%]     button{width:325px}.login-form[_ngcontent-%COMP%]   .not-authorized[_ngcontent-%COMP%]{width:350px}}"]}),o})(),Z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["auth"]],standalone:!0,features:[e.jDz],decls:8,vars:0,consts:[[1,"auth-container"],[1,"auth-wrapper"],[1,"auth-wrapper__logo"],["src","../../../../../assets/images/auth/lomi-logo.png"],[1,"bg-image"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"img",3),e.TgZ(4,"p"),e._uU(5,"Sigamos apoyando el comercio local"),e.qZA()(),e._UZ(6,"login-form"),e.qZA()(),e._UZ(7,"div",4))},dependencies:[m.ez,I],styles:[".auth-container[_ngcontent-%COMP%]{background-image:url(login-background.e3c6ec174b51c34f.png);background-size:100% 100%;min-height:100vh;display:flex;justify-content:center;align-items:center}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]{min-width:350px;text-align:center;padding-bottom:2rem}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]{margin-bottom:2rem}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;margin-bottom:.5rem}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600;font-size:12px;color:#424962}@media screen and (max-width: 768px){.auth-container[_ngcontent-%COMP%]{background-image:none;align-items:start}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]{margin:2rem 0 3rem}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:0}.auth-container[_ngcontent-%COMP%]   .auth-wrapper[_ngcontent-%COMP%]   .auth-wrapper__logo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.bg-image[_ngcontent-%COMP%]{background-size:100% 100%;background-image:url(login-background-short.a37e9ba7b1ea13ab.png);height:400px;position:absolute;inset:390px 0 0}}"]}),o})()}}]);